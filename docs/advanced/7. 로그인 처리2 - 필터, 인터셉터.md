# 7. ë¡œê·¸ì¸ ì²˜ë¦¬2 - ì„œë¸”ë¦¿ í•„í„°, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°> í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥, ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥<br/>## ëª©ì°¨- ì„œë¸”ë¦¿ í•„í„°- ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸ì— í™œìš©- ì„œë¸”ë¦¿ í•„í„° - ì¸ì¦ ì²´í¬ì— í™œìš©- ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - HandlerInterceptor<br/><br/><br/># ğŸ’¡ì„œë¸”ë¦¿ í•„í„°**ê³µí†µ ê´€ì‹¬ ì‚¬í•­**ìš”êµ¬ì‚¬í•­ì„ ë³´ë©´ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë§Œ ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.ì•ì—ì„œ ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²ŒëŠ” ìƒí’ˆ ê´€ë¦¬ ë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ì–´ ë³´ì¸ë‹¤.ê·¸ëŸ°ë° ë¬¸ì œëŠ” ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ URL(`localhost:8080/items`)ì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ, ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ìƒí’ˆê´€ë¦¬ì˜ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤.ë” í° ë¬¸ì œëŠ” í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë  ë•Œ ì´ë‹¤. ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ë‹¤ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ ìˆë‹¤.ì´ë ‡ê²Œ **ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ìˆëŠ” ê²ƒ**ì„ `ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)` ë¼ê³  í•œë‹¤.ì´ëŸ¬í•œ **ê³µí†µ ê´€ì‹¬ì‚¬**ëŠ” `ìŠ¤í”„ë§ì˜ AOP` ë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ,  **ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬**ëŠ” ì§€ê¸ˆë¶€í„° ì„¤ëª…í•  `ì„œë¸”ë¦¿ í•„í„°` ë˜ëŠ” `ìŠ¤í”„ë§ ì¸í„°ì…‰í„°`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `HttpServletRequest` ë¥¼ ì œê³µí•œë‹¤.**í•„í„° íë¦„**```textHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬```- í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œ ëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤.- ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.- í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤.`/*` ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.**í•„í„° ì œí•œ**```textHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ //ë¡œê·¸ì¸ ì‚¬ìš©ìHTTP ìš”ì²­ -> WAS -> í•„í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì„œë¸”ë¦¿ í˜¸ì¶œX) //ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì```**í•„í„° ì²´ì¸**```textHTTP ìš”ì²­ -> WAS -> í•„í„°1 -> í•„í„°2 -> í•„í„°3 -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬```- **í•„í„°ëŠ” ì²´ì¸(`FilterChain`)** ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.- ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.**í•„í„° ì¸í„°í˜ì´ìŠ¤**```javapublic interface Filter {        public default void init(FilterConfig filterConfig) throws ServletException {}        public void doFilter(ServletRequest request, ServletResponse response,                         FilterChain chain) throws IOException, ServletException;        public default void destroy() {}}```í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤.- `init()`: í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.- `doFilter()`: ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.- `destroy()`: í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.<br/><br/># ğŸ’¡ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸ì— í™œìš©ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ìƒì„±í•˜ê³  ì ìš©**LogFilter - ë¡œê·¸ í•„í„°**```java@Slf4jpublic class LogFilter implements Filter {    @Override    public void init(FilterConfig filterConfig) throws ServletException {        log.info("log filter init");    }    @Override    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {        HttpServletRequest httpServletRequest = (HttpServletRequest) request;        String requestURI = httpServletRequest.getRequestURI();        String uuid = UUID.randomUUID().toString();        try {            log.info("REQUEST [{}][{}]", uuid, requestURI);            chain.doFilter(request, response);        } catch (Exception e) {            throw e;        } finally {            log.info("RESPONSE [{}][{}]", uuid, requestURI);        }    }    @Override    public void destroy() {        log.info("log filter destroy");    }}```- `public class LogFilter implements Filter {}`    - í•„í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.- `doFilter(ServletRequest request, ServletResponse response, FilterChain chain)`    - HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter` ê°€ í˜¸ì¶œëœë‹¤.    - `ServletRequest request` ëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) request;` ì™€ ê°™ì´ ë‹¤ìš´ ì¼€ìŠ¤íŒ… í•˜ë©´ ëœë‹¤.- `String uuid = UUID.randomUUID().toString();`    - HTTP ìš”ì²­(ì‚¬ìš©ì)ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ uuid ë¥¼ ìƒì„±í•´ë‘”ë‹¤.- `log.info("REQUEST [{}][{}]", uuid, requestURI);`    - `uuid` ì™€ `requestURI` ë¥¼ ì¶œë ¥í•œë‹¤.- `chain.doFilter(request, response);`    - ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.- `log.info("RESPONSE [{}][{}]", uuid, requestURI);`    - `chain.doFilter(request, response);`ë¥¼ í†µí•´ ì„œë¸”ë¦¿ê¹Œì§€ í˜¸ì¶œí•˜ì—¬ ì „ì²´ì ì¸ ê³¼ì •ì„ ì™„ë£Œí•œ í›„ì— ë‹¤ì‹œ ëŒì•„ì™€ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¶€ë¶„**WebConfig - í•„í„° ì„¤ì •**```java@Configurationpublic class WebConfig {        @Bean    public FilterRegistrationBean logFilter() {        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();        filterRegistrationBean.setFilter(new LogFilter());        filterRegistrationBean.setOrder(1);        filterRegistrationBean.addUrlPatterns("/*");        return filterRegistrationBean;    }}```í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `FilterRegistrationBean` ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.- `setFilter(new LogFilter())` : ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.- `setOrder(1)` : í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘í•œë‹¤.- `addUrlPatterns("/*")` : í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.**ê²°ê³¼**![Servlet logFilter example](https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/cb5f82cb-0309-4859-9b15-f6ff5701a931)<br/><br/>> ### ì°¸ê³ >> `@ServletComponentScan @WebFilter(filterName = "logFilter", urlPatterns = "/*")` ë¡œ í•„í„° ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•„í„° ìˆœì„œ ì¡°ì ˆì´ ì•ˆëœë‹¤. ë”°ë¼ì„œ `FilterRegistrationBean` ì„ ì‚¬ìš©í•˜ì.```java@Component@WebFilter(urlPatterns = "/*")@Order(2) // ì •ë ¬ì€ @Order ìœ¼ë¡œ, @Component ìœ¼ë¡œ Bean ìœ¼ë¡œ ë“±ë¡í•˜ë©´ FilterRegistrationBean ê³¼ ë˜‘ê°™ì´ ì‘ë™í•˜ê¸´ í•œë‹¤. // ì´ ê¸°ëŠ¥ì€ ì„œë¸”ë¦¿ì—ì„œ ì• ë…¸í…Œì´ì…˜ì„ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ëŠ” ì•Šì§€ë§Œ ìŠ¤í”„ë§ì´ ê°€ëŠ¥í•˜ë„ë¡ ì§€ì›ì„ í•´ì£¼ë‚˜ ë³´ë‹¤.```ì°¸ê³ : https://www.inflearn.com/questions/1164198<br/><br/>### â­ï¸logback MDCì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ `logback mdc`ë¡œ ê²€ìƒ‰ í•´ë³´ì.<br/><br/><br/># ğŸ’¡ì„œë¸”ë¦¿ í•„í„° - ì¸ì¦ ì²´í¬**LoginCheckFilter - ì¸ì¦ ì²´í¬ í•„í„°**```java@Slf4jpublic class LoginCheckFilter implements Filter {    private static final String[] whiteList = {"/", "/members/add", "/login", "/logout", "/css/*"};    @Override    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {        HttpServletRequest httpServletRequest = (HttpServletRequest) request;        String requestURI = httpServletRequest.getRequestURI();        HttpServletResponse httpServletResponse = (HttpServletResponse) response;        try {            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ {}", requestURI);            if (isLoginCheckPath(requestURI)) {                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);                HttpSession session = httpServletRequest.getSession(false);                if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);                    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ redirect                    httpServletResponse.sendRedirect("/login?redirectURL=" + requestURI);                    return; // ì—¬ê¸°ê°€ ì¤‘ìš”, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë                 }            }            // ì¸ì¦ ì‚¬ìš©ìì˜ ê²½ìš° ë‹¤ìŒ í•„í„°ë‚˜ ì„œë¸”ë¦¿ í˜¸ì¶œ            chain.doFilter(request, response);        }        catch (Exception e) {            throw e;        }finally {            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);        }    }    private boolean isLoginCheckPath(String requestURI) {        return !PatternMatchUtils.simpleMatch(whiteList, requestURI);    }}```- `whitelist = {"/", "/members/add", "/login", "/logout","/css/*"};`    - ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤. í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.- `isLoginCheckPath(requestURI)`    - í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì— ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.- `httpResponse.sendRedirect("/login?redirectURL=" + requestURI);`    - ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤. ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•´ë²„ë¦¬ë©´, ì›í•˜ëŠ” ê²½ë¡œë¥¼ ë‹¤ì‹œ ì°¾ì•„ê°€ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì„ ë³´ë ¤ê³  ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë©´, ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤.      ì´ëŸ° ë¶€ë¶„ì´ ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¢€ ê·€ì°®ì„ ìˆ˜ ìˆì–´ë„ ì‚¬ìš©ì ì…ì¥ìœ¼ë¡œ ë³´ë©´ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ìœ„í•´ í˜„ì¬ ìš”ì²­í•œ ê²½ë¡œì¸ `requestURI` ë¥¼ `/login` ì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•¨ê»˜ ì „ë‹¬í•œë‹¤. ë¬¼ë¡  `/login` ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.    - `sendRedirect("/login?redirectURL=" + requestURI)`ë¥¼ í†µí•´ GETì˜ `/login?...` ìœ¼ë¡œ ìš”ì²­í•˜ëŠ”ë° `/login?...`ì—ì„œëŠ” `/login/loginForm.html` ë¡œ ë Œë”ë§ì„ ì§„í–‰í•œë‹¤. `loginForm.html` ì˜ `th:action`ì´ ê°’ì´ ì§€ì •ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ POST `/login?...` ë¡œ ìš”ì²­ì„ ë³´ë‚´ ì‘ì—…ì„ ì²˜ë¦¬í•œë‹¤.- `return;`    - ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.      ì•ì„œ `redirect` ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— `redirect` ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.<br/>**WebConfig - loginCheckFilter() ì¶”ê°€**```java    @Bean    public FilterRegistrationBean loginCheckFilter() {        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();        filterRegistrationBean.setFilter(new LoginCheckFilter());        filterRegistrationBean.setOrder(2);        filterRegistrationBean.addUrlPatterns("/*");        return filterRegistrationBean;    }```- `setFilter(new LoginCheckFilter())` : ë¡œê·¸ì¸ í•„í„°ë¥¼ ë“±ë¡í•œë‹¤.- `setOrder(2)` : ìˆœì„œë¥¼ 2ë²ˆìœ¼ë¡œ ì¡ì•˜ë‹¤. ë¡œê·¸ í•„í„° ë‹¤ìŒì— ë¡œê·¸ì¸ í•„í„°ê°€ ì ìš©ëœë‹¤.- `addUrlPatterns("/*")` : ëª¨ë“  ìš”ì²­ì— ë¡œê·¸ì¸ í•„í„°ë¥¼ ì ìš©í•œë‹¤.<br/>## âš¡ï¸RedirectURL ì²˜ë¦¬ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.**LoginController - loginV4()**```java@PostMapping("/login")public String loginV4(@Validated @ModelAttribute LoginForm form, BindingResult bindingResult,                      @RequestParam(defaultValue = "/") String redirectURL,                      HttpServletRequest request) {        if (bindingResult.hasErrors()) {        return "/login/loginForm";    }    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());    log.info("login? {}", loginMember);    if (loginMember == null) {        bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");        return "login/loginForm";    }    // ì„¸ì…˜ì´ ìˆìœ¼ë©´ ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ ìƒì„±    HttpSession session = request.getSession();    // ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€    session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);    return "redirect:" + redirectURL;}```**ê²°ê³¼**![loginCheckFilter example](https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/0d998897-00b2-40f8-ab47-d4618864c768)# ğŸ’¡ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - HandlerInterceptorìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë„ ì„œë¸”ë¦¿ í•„í„°ì™€ ê°™ì´ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì´ë‹¤.ë‘˜ë‹¤ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì ìš©ë˜ëŠ” ìˆœì„œì™€ ë²”ìœ„, ê·¸ë¦¬ê³  ì‚¬ìš©ë°©ë²•ì´ ë‹¤ë¥´ë‹¤.**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° íë¦„**```textHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬```- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `DispatcherServlet` ê³¼ `Controller` ì‚¬ì´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ëœë‹¤.- `ìŠ¤í”„ë§ ì¸í„°ì…‰í„°`ëŠ” `ìŠ¤í”„ë§ MVC` ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— ê²°êµ­ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ ì´í›„ì— ë“±ì¥í•˜ê²Œ ëœë‹¤.- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ì—ë„ URL íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì„œë¸”ë¦¿ URL íŒ¨í„´ê³¼ëŠ” ë‹¤ë¥´ê³ , ë§¤ìš° ì •ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì œí•œ**```textHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬ //ë¡œê·¸ì¸ ì‚¬ìš©ìHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œX) // ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì```ì¸í„°ì…‰í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì²´ì¸**```textHTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„°1 -> ì¸í„°ì…‰í„°2 -> ì»¨íŠ¸ë¡¤ëŸ¬```**ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— ì¸í„°ì…‰í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.**ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ë³´ë©´ ì„œë¸”ë¦¿ í•„í„°ì™€ í˜¸ì¶œ ë˜ëŠ” ìˆœì„œë§Œ ë‹¤ë¥´ê³ , ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ ë¹„ìŠ·í•´ ë³´ì¸ë‹¤.ì•ìœ¼ë¡œ ì„¤ëª…í•˜ê² ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í•„í„°ë³´ë‹¤ í¸ë¦¬í•˜ê³ , ë” ì •êµí•˜ê³  ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì¸í„°í˜ì´ìŠ¤ - `HandlerInterceptor`**```javapublic interface HandlerInterceptor {         default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {}        default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {}    default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {}}```- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœí•˜ê²Œ `doFilter()` í•˜ë‚˜ë§Œ ì œê³µëœë‹¤. ì¸í„°ì…‰í„°ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „( `preHandle` ), í˜¸ì¶œ í›„( `postHandle` ), ìš”ì²­ ì™„ë£Œ ì´í›„( `afterCompletion` )ì™€ ê°™ì´ ë‹¨ê³„ì ìœ¼ë¡œ ì˜ ì„¸ë¶„í™” ë˜ì–´ ìˆë‹¤.- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœíˆ `request` , `response` ë§Œ ì œê³µí–ˆì§€ë§Œ, ì¸í„°ì…‰í„°ëŠ” ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬( `handler` )ê°€ í˜¸ì¶œë˜ëŠ”ì§€ í˜¸ì¶œ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.  ê·¸ë¦¬ê³  ì–´ë–¤ `modelAndView` ê°€ ë°˜í™˜ë˜ëŠ”ì§€ ì‘ë‹µ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.## âš¡ï¸ìŠ¤í”„ë§ ì¸í„°ì…‰í„° í˜¸ì¶œ íë¦„**ì •ìƒ íë¦„**![image](https://user-images.githubusercontent.com/83503188/210550231-1aef5b0d-1c80-4cb5-b7d4-451ee5fafd46.png)- `preHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤. ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì—…ëŒ€í„° í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.    - `preHandle`ì˜ ì‘ë‹µê°’ì´ `true`ì´ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ê³ , `false`ì´ë©´ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. `false`ì¸ ê²½ìš° ë‚˜ë¨¸ì§€ ì¸í„°ì…‰í„°ëŠ” ë¬¼ë¡ ì´ê³ , í•¸ë“¤ëŸ¬ ì–´ëŒ‘í† ë„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.- `postHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤. ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤.- `afterCompletion`: ë·°ê°€ ë Œë”ë§ ëœ ì´í›„ì— í˜¸ì¶œëœë‹¤.**ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì˜ˆì™¸ ìƒí™©**![image](https://user-images.githubusercontent.com/83503188/210550754-deea04b4-c4f0-4ded-bc90-a08e5190787a.png)**ì˜ˆì™¸ê°€ ë°œìƒì‹œ**- `preHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤. ë”°ë¼ì„œ í˜¸ì¶œëœë‹¤.- `postHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle` ì€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.- `afterCompletion` : `afterCompletion` ì€ í•­ìƒ í˜¸ì¶œëœë‹¤. ì´ ê²½ìš° ì˜ˆì™¸( `ex` )ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ë¡œê·¸ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.    - ì˜ˆì™¸ì™€ ë¬´ê´€í•˜ê²Œ ê³µí†µ ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ `afterCompletion()`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.    - ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `afterCompletion()`ì˜ ì˜ˆì™¸ ì •ë³´( `ex` )ë¥¼ í¬í•¨í•´ì„œ í˜¸ì¶œëœë‹¤.ìŠ¤í”„ë§ MVCë¥¼ ì‚¬ìš©í•˜ê³ , íŠ¹ë³„íˆ í•„í„°ë¥¼ ê¼­ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆë¼ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬í•˜ë‹¤.## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ìš”ì²­ ë¡œê·¸**LogInterceptor - ìš”ì²­ ë¡œê·¸ ì¸í„°ì…‰í„°**```java@Slf4jpublic class LogInterceptor implements HandlerInterceptor {  public static final String LOG_ID = "logId";  @Override  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {    String requestURI = request.getRequestURI();    String uuid = UUID.randomUUID().toString();    request.setAttribute(LOG_ID, uuid);    // @RequestMapping: HandlerMethod    // ì •ì  ë¦¬ì†ŒìŠ¤: ResourceHttpRequestHandler    if (handler instanceof HandlerMethod) {      HandlerMethod hm = (HandlerMethod) handler; // í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.      Method method = hm.getMethod();      log.info("handler={}, method={}", hm, method);    } else if (handler instanceof ResourceHttpRequestHandler) {      ResourceHttpRequestHandler httpRequestHandler = (ResourceHttpRequestHandler) handler;      log.info("handler={}", httpRequestHandler);    }        log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);    return true;  }  @Override  public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {    log.info("postHandle [{}]", modelAndView);  }  @Override  public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {    String requestURI = request.getRequestURI();    String logId = (String) request.getAttribute(LOG_ID);    log.info("RESPONSE [{}][{}]", logId, requestURI);    if (ex != null) {      log.error("afterCompletion error!!", ex);    }  }}```- `String uuid = UUID.randomUUID().toString()`    - ìš”ì²­ ë¡œê·¸ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ uuid ë¥¼ ìƒì„±í•œë‹¤.- `request.setAttribute(LOG_ID, uuid)`    - ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ì§€ì—­ë³€ìˆ˜ë¡œ í•´ê²°ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” í˜¸ì¶œ ì‹œì ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤.      ë”°ë¼ì„œ preHandle ì—ì„œ ì§€ì •í•œ ê°’ì„ `postHandle` , `afterCompletion` ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì–´ë”˜ê°€ì— ë‹´ì•„ë‘ì–´ì•¼ í•œë‹¤. `LogInterceptor` ë„ ì‹±ê¸€í†¤ ì²˜ëŸ¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë§´ë²„ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„í—˜í•˜ë‹¤.      ë”°ë¼ì„œ request ì— ë‹´ì•„ë‘ì—ˆë‹¤. ì´ ê°’ì€ `afterCompletion` ì—ì„œ `request.getAttribute(LOG_ID)` ë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•œë‹¤.- `return true;`    - `true` ë©´ ì •ìƒ í˜¸ì¶œì´ë‹¤. ë‹¤ìŒ ì¸í„°ì…‰í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤.```javaif (handler instanceof HandlerMethod) {    HandlerMethod hm = (HandlerMethod) handler; //í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.}```**HandlerMethod**í•¸ë“¤ëŸ¬ ì •ë³´ëŠ” ì–´ë–¤ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ê°€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ `@Controller` , `@RequestMapping` ì„ í™œìš©í•œ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ê²½ìš° í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ`HandlerMethod` ê°€ ë„˜ì–´ì˜¨ë‹¤.**ResourceHttpRequestHandler**`@Controller` ê°€ ì•„ë‹ˆë¼ `/resources/static` ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œ ë˜ëŠ” ê²½ìš° `ResourceHttpRequestHandler` ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— íƒ€ì…ì— ë”°ë¼ì„œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.**postHandle, afterCompletion**ì¢…ë£Œ ë¡œê·¸ë¥¼ postHandle ì´ ì•„ë‹ˆë¼ `afterCompletion` ì—ì„œ ì‹¤í–‰í•œ ì´ìœ ëŠ”, ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° `postHandle` ê°€ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. `afterCompletion` ì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œ ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.**WebConfig - ì¸í„°ì…‰í„° ë“±ë¡**```java@Configurationpublic class WebConfig implements WebMvcConfigurer {  @Override  public void addInterceptors(InterceptorRegistry registry) {    registry.addInterceptor(new LogInterceptor())            .order(1)            .addPathPatterns("/**")            .excludePathPatterns("/css/**", "/*.ico", "/error");  }  ...}````WebMvcConfigurer` ê°€ ì œê³µí•˜ëŠ” `addInterceptors()` ë¥¼ ì‚¬ìš©í•´ì„œ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.- `registry.addInterceptor(new LogInterceptor())` : ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•œë‹¤.- `order(1)` : ì¸í„°ì…‰í„°ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ ì§€ì •í•œë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € í˜¸ì¶œëœë‹¤.- `addPathPatterns("/**")` : ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤.- `excludePathPatterns("/css/**", "/*.ico", "/error")` : ì¸í„°ì…‰í„°ì—ì„œ ì œì™¸í•  íŒ¨í„´ì„ ì§€ì •í•œë‹¤.í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ì¸í„°ì…‰í„°ëŠ” `addPathPatterns` , `excludePathPatterns` ë¡œ ë§¤ìš° ì •ë°€í•˜ê²Œ URL íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.**ê²°ê³¼**![image](https://user-images.githubusercontent.com/83503188/210556150-e1521c99-4879-4398-a28f-93653e55e6e7.png)**ì •ì  ë¦¬ì†ŒìŠ¤ ê²°ê³¼**![image](https://user-images.githubusercontent.com/83503188/210557237-f62fe922-7e31-4600-acbe-b3750e3bc676.png)**ìŠ¤í”„ë§ì˜ URL ê²½ë¡œ**ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œëŠ” ì„œë¸”ë¦¿ ê¸°ìˆ ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œì™€ ì™„ì „íˆ ë‹¤ë¥´ë‹¤. ë”ìš± ìì„¸í•˜ê³ , ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.- PathPattern ê³µì‹ ë¬¸ì„œ    - ë§í¬: https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ì¸ì¦ ì²´í¬**LoginCheckInterceptor**```java@Slf4jpublic class LoginCheckInterceptor implements HandlerInterceptor {    @Override    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {        String requestURI = request.getRequestURI();        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);        HttpSession session = request.getSession(false);        if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");            //ë¡œê·¸ì¸ìœ¼ë¡œ redirect            response.sendRedirect("/login?redirectURL=" + requestURI);            return false;        }        return true;    }}```**WebConfig**```java@Configurationpublic class WebConfig implements WebMvcConfigurer {  @Override  public void addInterceptors(InterceptorRegistry registry) {    registry.addInterceptor(new LogInterceptor())            .order(1)            .addPathPatterns("/**") // "/" í•˜ìœ„ ëª¨ë‘            .excludePathPatterns("/css/**", "/*.ico", "/error");    registry.addInterceptor(new LoginCheckInterceptor())            .order(2)            .addPathPatterns("/**")            .excludePathPatterns(                    "/", "/members/add", "/login", "/logout",                    "/css/**", "/*.ico", "/error"            );  }  ...}```**ê²°ê³¼**![image](https://user-images.githubusercontent.com/83503188/210559481-5cf0f55e-b1fc-4241-a0d0-d3f5ca85a97e.png)## ArgumentResolver í™œìš©`ArgumentResolver`ë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ íšŒì›ì„ ì¡°ê¸ˆ í¸ë¦¬í•˜ê²Œ ì°¾ì•„ë³´ì.**HomeController - ì¶”ê°€**```java    @GetMapping("/")    public String homeLoginV3ArgumentResolver(            @Login Member loginMember, Model model) {        if (loginMember == null) {            return "home";        }        //ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™        model.addAttribute("member", loginMember);        return "loginHome";    }````@Login` ì• ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ì§ì ‘ ë§Œë“  `ArgumentResolver` ê°€ ë™ì‘í•´ì„œ ìë™ìœ¼ë¡œ ì„¸ì…˜ì— ìˆëŠ” ë¡œê·¸ì¸ íšŒì›ì„ ì°¾ì•„ì£¼ê³ , ë§Œì•½ ì„¸ì…˜ì— ì—†ë‹¤ë©´ `null` ì„ ë°˜í™˜í•˜ë„ë¡ ê°œë°œí•´ë³´ì.**@Login ì• ë…¸í…Œì´ì…˜ ìƒì„±**```java@Target(ElementType.PARAMETER)@Retention(RetentionPolicy.RUNTIME)public @interface Login {}```- `@Target(ElementType.PARAMETER)` : íŒŒë¼ë¯¸í„°ì—ë§Œ ì‚¬ìš©- `@Retention(RetentionPolicy.RUNTIME)` : ë¦¬í”Œë ‰ì…˜ ë“±ì„ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ëŸ°íƒ€ì„ê¹Œì§€ ì• ë…¸í…Œì´ì…˜ ì •ë³´ê°€ ë‚¨ì•„ìˆìŒ**LoginMemberArgumentResolver ìƒì„±**```java@Slf4jpublic class LoginMemberArgumentResolver implements HandlerMethodArgumentResolver {    @Override    public boolean supportsParameter(MethodParameter parameter) {        log.info("supportParameter ì‹¤í–‰");        boolean hasLoginAnnotation = parameter.hasParameterAnnotation(Login.class);        boolean hasMemberType = Member.class.isAssignableFrom(parameter.getParameterType());        return hasLoginAnnotation && hasMemberType;    }    @Override    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {        log.info("resolveArgument ì‹¤í–‰");        HttpServletRequest request = (HttpServletRequest) webRequest.getNativeRequest();        HttpSession session = request.getSession(false);        if (session == null) {            return null;        }        return session.getAttribute(SessionConst.LOGIN_MEMBER);    }}```- `supportsParameter()` : `@Login` ì• ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ì„œ `Member` íƒ€ì…ì´ë©´ í•´ë‹¹ `ArgumentResolver`ê°€ ì‚¬ìš©ëœë‹¤.    - ë‚´ë¶€ ìºì‹± ì²˜ë¦¬ë¡œ ì¸í•´ í•´ë‹¹ ë©”ì„œë“œëŠ” ìµœì´ˆ í˜¸ì¶œì—ë§Œ ì‹¤í–‰ëœë‹¤. ë”°ë¼ì„œ ë‘ë²ˆì§¸ í˜¸ì¶œë¶€í„°ëŠ” ë°”ë¡œ `resolveArgument()`ê°€ í˜¸ì¶œëœë‹¤.- `resolveArgument()` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ë˜ì–´ì„œ í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ì—¬ê¸°ì„œëŠ” ì„¸ì…˜ì— ìˆëŠ” ë¡œê·¸ì¸ íšŒì› ì •ë³´ì¸ `member` ê°ì²´ë¥¼ ì°¾ì•„ì„œ ë°˜í™˜í•´ì¤€ë‹¤. ì´í›„ ìŠ¤í”„ë§MVCëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì—¬ê¸°ì—ì„œ ë°˜í™˜ëœ `member` ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ì— ì „ë‹¬í•´ì¤€ë‹¤.**`WebMvcConfigurer` ì— ì„¤ì • ì¶”ê°€**```java@Configurationpublic class WebConfig implements WebMvcConfigurer {  @Override  public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {    resolvers.add(new LoginMemberArgumentResolver());  }  ...}```# ğŸ’¡ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°? ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°?### **â­ï¸ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°?**- ìš°ì„  í•„í„°ëŠ” Request/Response ê°ì²´ë¥¼ ì¡°ì‘(ë‹¤ë¥¸ ê°ì²´ë¡œ ë°”ê¿”ì¹˜ê¸°)í•  ìˆ˜ ìˆê³ , ì¸í„°ì…‰í„°ëŠ” ì¡°ì‘í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš° - ë‹¤ìŒìœ¼ë¡œ í•„í„°ëŠ” DispatcherServlet ì•ë‹¨ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ ì „ì—­ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì‘ì—…ì— ì í•©í•˜ë‹¤. -> ë³´ì•ˆ ê³µí†µ ì‘ì—…(XSS ë°©ì–´, ...)ì„ ì²˜ë¦¬í•˜ì—¬ `ìŠ¤í”„ë§ ì»¨í…Œì–´ë„ˆ`ê¹Œì§€ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë”ìš± ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.### **â­ï¸ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°?**- AOP í‰ë‚´ë¥¼ ë‚¼ ìˆ˜ ìˆë‹¤.   - @RequestMapping ì„ ì–¸ìœ¼ë¡œ ìš”ì²­ì— ëŒ€í•œ HandlerMethod(@Controllerì˜ ë©”ì„œë“œ)ê°€ ì •í•´ì¡Œë‹¤ë©´, handler ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ HandlerMethod ê°€ ë“¤ì–´ì˜¨ë‹¤. HandlerMethod ë¡œ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë“± ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ íŒŒì•…í•´ì„œ ë¡œì§ ì‹¤í–‰ ì—¬ë¶€ë¥¼ íŒë‹¨í•  ìˆ˜ ìˆë‹¤. - View ë¥¼ ë Œë”ë§í•˜ê¸° ì „ì— ì¶”ê°€ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.   - ì˜ˆë¥¼ ë“¤ì–´ ì›¹ í˜ì´ì§€ê°€ ê¶Œí•œì— ë”°ë¼ GNB(Global Navigation Bar)ì´ í•­ëª©ì´ ë‹¤ë¥´ê²Œ ë…¸ì¶œë˜ì–´ì•¼ í•  ë•Œ ë“±ì˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ì¢‹ë‹¤.ì°¸ê³ : https://supawer0728.github.io/2018/04/04/spring-filter-interceptor/https://www.inflearn.com/questions/206345